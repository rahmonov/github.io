<!DOCTYPE html>
<html lang="en">
<head prefix="og: http://ogp.me/ns#">
          <title> Close modal on back button in AngularJS </title>

        <link rel="stylesheet" href="/static/css/main.css" />
        <link rel="stylesheet" href="/static/css/pygment.css" />
        <link rel="stylesheet" href="/static/css/font-awesome.min.css" />
        <link href="//fonts.googleapis.com/css?family=Droid+Sans:400,700" rel="stylesheet" type="text/css">
        <link rel="stylesheet" href="/static/vendor/lightbox2/css/lightbox.min.css">
        <link href="https://afeld.github.io/emoji-css/emoji.css" rel="stylesheet">

        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="<p>How to close modal on back button in AngularJS without going back in browser history</p>" />
        <meta name="author" content="Jahongir Rahmonov" />
        <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">

<meta property="og:title" content="Close modal on back button in AngularJS">
<meta property="og:type" content="website">
<meta property="og:image" content="/static/images/programming.jpg">
<meta property="og:url" content="http://rahmonov.me/posts/close-modal-on-back-button/">
<meta property="og:description" content="<p>How to close modal on back button in AngularJS without going back in browser history</p>">

        <link href="http://rahmonov.me/feeds/atom.xml" type="application/atom+xml" rel="alternate" title="Jahongir Rahmonov Full Atom Feed" />
        <link href="http://rahmonov.me/feeds/rss.xml" type="application/rss+xml" rel="alternate" title="Jahongir Rahmonov Full RSS Feed" />
        <link href="http://rahmonov.me/feeds/programming.atom.xml" type="application/atom+xml" rel="alternate" title="Jahongir Rahmonov Categories Atom Feed" />


        <meta name="description" content="<p>How to close modal on back button in AngularJS without going back in browser history</p>" />

    <meta name="tags" content="javascript" />
    <meta name="tags" content="angularjs" />
    <meta name="tags" content="modal" />

</head>

<body id="index" class="home">
    <div class="container">

        <button class="nav js-mobile">
            <i class="fa fa-bars"></i>
        </button>

        <div class="side">
            <div class="logo">
                <a href="/"><img src="/static/images/me.jpg" class="jahon" alt="Jahongir Rahmonov"/></a>
            </div>

            <h2>Jahongir Rahmonov</h2>

            <div class="paragraphs">
<p>
    I'm a Software Developer at <a href="http://mysuperdispatch.com/">Super Dispatch (TechStars '16)</a>.
    Avid reader.
    <a href="http://wiut.uz/">WIUT</a> graduate.
    Blogger and an amateur speaker
</p>
<p>
    I write about Python, Django, AngularJS and sometimes something non-technical.
</p>
<p>
    Welcome to my corner <i class="em em-snake"></i>
</p>            </div>

            <form method="get" action="https://www.google.com/search">
                <input name="sitesearch" value="rahmonov.me" type="hidden">
                <input type="text" id="search-query" class="field field-text" required="required" name="q" placeholder="Search..." autocomplete="off">
                <input type="image" src="/static/images/search-icon.png" width="20" height="20" class="search-icon" title="Search via Google" alt="Search via Google">
            </form>

            <ul class="menu">
                <li><a href="/">Home</a></li>
                <li><a href="/pages/posts.html">Tech Posts</a></li>
                <li><a href="/pages/non-tech-posts.html">Other Posts</a></li>
                <li><a href="/pages/about.html">About</a></li>
                <li><a href="/pages/about.html#contact">Contact</a></li>
                <li><a href="/feeds/atom.xml" target="_blank">RSS <i class="fa fa-rss"></i></a></li>
            </ul>

            <p class="profiles">
                <a title="GitHub" href="https://github.com/rahmonov" target="_blank"><i class="fa fa-github-square"></i></a>
                <a title="Twitter" href="https://twitter.com/the_rahmonov" target="_blank"><i class="fa fa-twitter-square"></i></a>
                <a title="Facebook" href="https://www.facebook.com/rahmonovj" target="_blank"><i class="fa fa-facebook-official"></i></a>
                <a title="Bitbucket" href="https://bitbucket.org/Jahongir/" target="_blank"><i class="fa fa-bitbucket-square"></i></a>
                <a title="LinkedIn" href="https://www.linkedin.com/in/jahongirrahmonov" target="_blank"><i class="fa fa-linkedin-square"></i></a>
            </p>
        </div>

        <div class="wrap">
            <div class="content">

  <h4>Sat 03 October 2015</h4>

  <h1>Close modal on back button in AngularJS</h1>

  <div class="entry-content">
    <p>We, developers, use modals all the time. I personally like to use <a href="https://github.com/likeastore/ngDialog">ngDialog</a>.</p>
<p>It is light, easy to use and highly customizable. <a href="https://angular-ui.github.io/bootstrap/#/modal">Bootstrap</a> is also good but 
it is somewhat heavy.</p>
<p>Here is how modal is opened in ngDialog:</p>
<div class="highlight"><pre><span></span><span class="nx">ngDialog</span><span class="p">.</span><span class="nx">open</span><span class="p">({</span>
    <span class="nx">template</span><span class="o">:</span> <span class="s1">&#39;externalTemplate.html&#39;</span><span class="p">,</span>
    <span class="nx">controller</span><span class="o">:</span> <span class="s1">&#39;SomeController&#39;</span>
<span class="p">});</span>
</pre></div>


<p>It will open up a modal as expected but when you press the back button of the browser, what happens?</p>
<p>I would expect the modal to close and stay where I was before the modal. But what happens is that you go
back in browser history. Ouch! Especially on mobile, it is really not convenient to press the small 'x' button
of the modal. That's why, I would guess, user would press the back button to close the modal.</p>
<p>Here is how I solved the problem:</p>
<p>First, I created a service that deals with modals and it has a flag <code>modalIsShown</code> which will be used later:</p>
<div class="highlight"><pre><span></span><span class="nx">myApp</span><span class="p">.</span><span class="nx">service</span><span class="p">(</span><span class="s1">&#39;ModalService&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;ngDialog&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">ngDialog</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">modalIsShown</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">openModal</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">template</span><span class="p">,</span> <span class="nx">controller</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">ngDialog</span><span class="p">.</span><span class="nx">open</span><span class="p">({</span>
      <span class="nx">template</span><span class="o">:</span> <span class="nx">template</span><span class="p">,</span>
      <span class="nx">controller</span><span class="o">:</span> <span class="nx">controller</span><span class="p">,</span>
      <span class="nx">closeByDocument</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
      <span class="nx">closeByEscape</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
      <span class="nx">showClose</span><span class="o">:</span> <span class="kc">false</span>
    <span class="p">});</span>
  <span class="p">};</span>

  <span class="kd">var</span> <span class="nx">closeModal</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">ngDialog</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
  <span class="p">};</span>

  <span class="k">return</span> <span class="p">{</span>
    <span class="nx">openModal</span><span class="o">:</span> <span class="nx">openModal</span><span class="p">,</span>
    <span class="nx">closeModal</span><span class="o">:</span> <span class="nx">closeModal</span><span class="p">,</span>
    <span class="nx">modalIsShown</span><span class="o">:</span> <span class="nx">modalIsShown</span>
  <span class="p">}</span>
<span class="p">}]);</span>
</pre></div>


<p>Second, Here is how I open up a modal from my controller:</p>
<div class="highlight"><pre><span></span><span class="nx">$scope</span><span class="p">.</span><span class="nx">contactModal</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">ModalService</span><span class="p">.</span><span class="nx">modalIsShown</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
  <span class="nx">ModalService</span><span class="p">.</span><span class="nx">openModal</span><span class="p">(</span><span class="s1">&#39;contactModal.html&#39;</span><span class="p">,</span> <span class="s1">&#39;FooterController&#39;</span><span class="p">);</span>
<span class="p">};</span>
</pre></div>


<p>Basically, the function sets the flag to true and opens the modal.</p>
<p>The most interestion part happens here:</p>
<div class="highlight"><pre><span></span><span class="nx">myApp</span><span class="p">.</span><span class="nx">run</span><span class="p">([</span><span class="s1">&#39;$rootScope&#39;</span><span class="p">,</span> <span class="s1">&#39;$route&#39;</span><span class="p">,</span> <span class="s1">&#39;$location&#39;</span><span class="p">,</span> <span class="s1">&#39;$routeParams&#39;</span><span class="p">,</span> <span class="s1">&#39;ModalService&#39;</span><span class="p">,</span>
  <span class="kd">function</span><span class="p">(</span><span class="nx">$rootScope</span><span class="p">,</span> <span class="nx">$route</span><span class="p">,</span> <span class="nx">$location</span><span class="p">,</span> <span class="nx">$routeParams</span><span class="p">,</span> <span class="nx">ModalService</span><span class="p">)</span> <span class="p">{</span>

  <span class="nx">$rootScope</span><span class="p">.</span><span class="nx">$on</span><span class="p">(</span><span class="s1">&#39;$routeChangeStart&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">evt</span><span class="p">,</span> <span class="nx">next</span><span class="p">,</span> <span class="nx">current</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">ModalService</span><span class="p">.</span><span class="nx">modalIsShown</span><span class="p">){</span>
      <span class="nx">ModalService</span><span class="p">.</span><span class="nx">closeModal</span><span class="p">();</span>
      <span class="nx">ModalService</span><span class="p">.</span><span class="nx">modalIsShown</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      <span class="nx">evt</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="p">});</span>
<span class="p">}]);</span>
</pre></div>


<p>When a user presses a back button, when the url is about to change, angular calls this <code>$routeChangeStart</code>
observing function. And this function checks whether the flag <code>modalIsShown</code> is set to true. If so, it means
that a user is trying to close a modal by pressing the back button, thus it closes the modal, sets the flag
back to false and prevents the url change.</p>
<p>If anyone could suggest a better or cleaner way in comments, that would be awesome.</p>
<p>Hope it helps.</p>
<p>Fight on!</p>
  </div>

<div class="end">
    <span>
        If you liked what you read, subscribe below. Once in a while, I will send you a list of my new posts.
    </span>

    <div id="popup">
        <p>
            <!-- Begin MailChimp Signup Form -->
            <link href="//cdn-images.mailchimp.com/embedcode/classic-10_7.css" rel="stylesheet" type="text/css">
            <style type="text/css">
                #mc_embed_signup{background:#fff; clear:left; font:14px Helvetica,Arial,sans-serif; }
                /* Add your own MailChimp form style overrides in your site stylesheet or in this style block.
                   We recommend moving this block and the preceding CSS link to the HEAD of your HTML file. */
            </style>
            <div id="mc_embed_signup">
            <form action="//rahmonov.us16.list-manage.com/subscribe/post?u=9e30bdfdfe0a7bd7cf7e0d50a&amp;id=af3f3c5f76" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
                <div id="mc_embed_signup_scroll">
            <div class="indicates-required"><span class="asterisk">*</span> indicates required</div>
            <div class="mc-field-group">
                <label for="mce-MMERGE1">Name </label>
                <input type="text" value="" name="MMERGE1" class="" id="mce-MMERGE1">
            </div>
            <div class="mc-field-group">
                <label for="mce-EMAIL">Email Address  <span class="asterisk">*</span>
            </label>
                <input type="email" value="" name="EMAIL" class="required email" id="mce-EMAIL">
            </div>
                <div id="mce-responses" class="clear">
                    <div class="response" id="mce-error-response" style="display:none"></div>
                    <div class="response" id="mce-success-response" style="display:none"></div>
                </div>    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
                <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_9e30bdfdfe0a7bd7cf7e0d50a_af3f3c5f76" tabindex="-1" value=""></div>
                <div class="clear"><input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button"></div>
                </div>
            </form>
            </div>
            <!--End mc_embed_signup-->
        </p>
    </div>
</div>
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES * * */
        var disqus_shortname = 'jrahmonov';

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
            </div>
        </div>
    </div>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-67392250-1', 'auto');
      ga('send', 'pageview');
    </script>

    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <script src="/static/js/mobile.js"></script>
    <script src="/static/vendor/lightbox2/js/lightbox.min.js"></script>
</body>
</html>