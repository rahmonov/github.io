<!DOCTYPE html><html lang="en"><head prefix="og: http://ogp.me/ns#"><title>Run a Django app with Nginx, Gunicorn and Supervisor in Ubuntu 16.04 (Part III)</title><link rel="stylesheet" href="/static/css/main.css"><link rel="stylesheet" href="/static/css/pygment.css"><link rel="stylesheet" href="/static/css/font-awesome.min.css"><link href="//fonts.googleapis.com/css?family=Droid+Sans:400,700" rel="stylesheet" type="text/css"><link rel="stylesheet" href="/static/vendor/lightbox2/css/lightbox.min.css"><link href="https://afeld.github.io/emoji-css/emoji.css" rel="stylesheet"><link rel="shortcut icon" type="image/png" href="/static/images/favicon.png"><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="description" content="<p>How to run a Django app with Nginx, Gunicorn and Supervisor</p>"><meta name="author" content="Jahongir Rahmonov"><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta property="og:title" content="Run a Django app with Nginx, Gunicorn and Supervisor in Ubuntu 16.04 (Part III)"><meta property="og:type" content="website"><meta property="og:image" content="/static/images/programming.jpg"><meta property="og:url" content="http://rahmonov.me/posts/run-a-django-app-with-nginx-gunicorn-and-supervisor/"><meta property="og:description" content="<p>How to run a Django app with Nginx, Gunicorn and Supervisor</p>"><link href="http://rahmonov.me/feeds/atom.xml" type="application/atom+xml" rel="alternate" title="Jahongir Rahmonov Full Atom Feed"><link href="http://rahmonov.me/feeds/rss.xml" type="application/rss+xml" rel="alternate" title="Jahongir Rahmonov Full RSS Feed"><link href="http://rahmonov.me/feeds/programming.atom.xml" type="application/atom+xml" rel="alternate" title="Jahongir Rahmonov Categories Atom Feed"><meta name="description" content="<p>How to run a Django app with Nginx, Gunicorn and Supervisor</p>"><meta name="tags" content="python"><meta name="tags" content="django"><meta name="tags" content="gunicorn"><meta name="tags" content="nginx"><meta name="tags" content="supervisord"><script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-7110437178205620",
            enable_page_level_ads: true
       });
  </script><link href="https://unpkg.com/ilyabirman-likely@2/release/likely.css" rel="stylesheet"><script src="https://unpkg.com/ilyabirman-likely@2/release/likely.js" type="text/javascript"></script></head><body id="index" class="home"><div class="container"><button class="nav js-mobile"><i class="fa fa-bars"></i></button><div class="side"><div class="logo"><a href="/"><img src="/static/images/me.jpg" width="150" height="150" class="jahon" alt="Jahongir Rahmonov"></a></div><h2>Jahongir Rahmonov</h2><div class="paragraphs"><p> I'm a Software Developer at <a href="http://mysuperdispatch.com/">Super Dispatch (TechStars '16)</a>. Avid reader. <a href="http://wiut.uz/">WIUT</a> graduate. Blogger and an amateur speaker </p><p> I write about Python, Django, AngularJS and sometimes something non-technical. </p><p> Welcome to my corner <i class="em em-snake"></i></p> </div><form method="get" action="https://www.google.com/search"><input name="sitesearch" value="rahmonov.me" type="hidden"><input type="text" id="search-query" class="field field-text" required name="q" placeholder="Search..." autocomplete="off"><input type="image" src="/static/images/search-icon.png" width="20" height="20" class="search-icon" title="Search via Google" alt="Search via Google"></form><ul class="menu"><li><a href="/">Home</a></li><li><a href="/pages/about.html">About</a></li><li><a href="/pages/about.html#subscribe">Subscribe</a></li><li><a href="/pages/about.html#contact">Contact</a></li><li><a href="/feeds/atom.xml">RSS <i class="fa fa-rss"></i></a></li></ul><p class="profiles"><a title="GitHub" href="https://github.com/rahmonov"><i class="fa fa-github-square"></i></a><a title="StackOverflow" href="https://stackoverflow.com/users/4137194/jahongir-rahmonov?tab=profile"><i class="fa fa-stack-overflow"></i></a><a title="Twitter" href="https://twitter.com/the_rahmonov"><i class="fa fa-twitter-square"></i></a><a title="Facebook" href="https://www.facebook.com/rahmonovj"><i class="fa fa-facebook-official"></i></a><a title="Instagram" href="https://www.instagram.com/rahmonov.me/"><i class="fa fa-instagram"></i></a><a title="LinkedIn" href="https://www.linkedin.com/in/jahongirrahmonov"><i class="fa fa-linkedin-square"></i></a></p><br><script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-7110437178205620" data-ad-slot="4214071905" data-ad-format="auto"></ins><script>
              (adsbygoogle = window.adsbygoogle || []).push({});
              </script></div><div class="wrap"><div class="content"><h4>Wed 08 March 2017</h4><h1>Run a Django app with Nginx, Gunicorn and Supervisor in Ubuntu 16.04 (Part III)</h1><div class="entry-content"><p>This tutorial is the continuation of <a href="http://rahmonov.me/posts/run-a-django-app-with-nginx-and-gunicorn/">this one</a> where we learned how to run a django app with nginx and gunicorn. Now we will add Supervisord into the mix.</p><h2>The reason we need Supervisord</h2><p>Right now, we have our app running with Nginx and Gunicorn. However, every time our machine boots we have to start gunicorn and overall, controlling (stopping, restarting and etc) gunicorn is very difficult. What we want is an easy way of doing so.</p><p>Welcome <a href="http://supervisord.org/">Supervisord</a> which allows us to monitor and control a number of processes on UNIX-like operating systems.</p><p>Let's remember how we used to start our app:</p><div class="highlight"><pre><span></span>gunicorn --daemon --workers <span class="m">3</span> --bind unix:/home/ubuntu/myproject/myproject.sock myproject.wsgi
</pre></div><p>I know right?! It is very long to type and those paths are very error prone. Now, try to stop that daemon (see what I mean? :) ). We will have to find all those gunicorn processes and kill them, which is at least cruel.</p><p>With supervisord at our disposal, it will be very easy and convenient to execute those commands:</p><div class="highlight"><pre><span></span>supervisorctl start myproject
supervisorctl stop myproject
supervisorctl restart myproject
</pre></div><p>You see how easy it is now?! Good. Now, let's set up this beast.</p><h2>Installation and Setup</h2><p>To install, type the following:</p><div class="highlight"><pre><span></span>sudo apt-get install supervisor
</pre></div><p>Now, restart it:</p><div class="highlight"><pre><span></span>sudo service supervisor restart
</pre></div><p>The main configuration file of supervisord is here <code>/etc/supervisor/supervisord.conf</code>. If we take a look, we will see that it contains these lines:</p><div class="highlight"><pre><span></span><span class="o">[</span>include<span class="o">]</span>
<span class="nv">files</span> <span class="o">=</span> /etc/supervisor/conf.d/*.conf
</pre></div><p>It means that config files of specific projects can be stored here <code>/etc/supervisor/conf.d/</code> and they will be included in that main file.</p><p>So, let's create <code>myproject.conf</code> in <code>/etc/supervisor/conf.d/</code> folder:</p><div class="highlight"><pre><span></span>sudo vim /etc/supervisor/conf.d/myproject.conf
</pre></div><p>and configure our project:</p><div class="highlight"><pre><span></span><span class="o">[</span>program:myproject<span class="o">]</span>
<span class="nv">command</span><span class="o">=</span>/home/ubuntu/myprojenv/bin/gunicorn --workers <span class="m">3</span> --bind unix:/home/ubuntu/myproject/myproject.sock myproject.wsgi
<span class="nv">directory</span><span class="o">=</span>/home/ubuntu/myproject
<span class="nv">autostart</span><span class="o">=</span><span class="nb">true</span>
<span class="nv">autorestart</span><span class="o">=</span><span class="nb">true</span>
<span class="nv">stderr_logfile</span><span class="o">=</span>/var/log/myproject.err.log
<span class="nv">stdout_logfile</span><span class="o">=</span>/var/log/myproject.out.log
</pre></div><p>Let's look at the significance of each line now:</p><div class="highlight"><pre><span></span><span class="o">[</span>program:myproject<span class="o">]</span>
</pre></div><p>Here, we are defining a program with the name <code>myproject</code>. This name will be used when we do such commands as:</p><div class="highlight"><pre><span></span>sudo supervisorctl start myproject
</pre></div><p>Next:</p><div class="highlight"><pre><span></span><span class="nv">command</span><span class="o">=</span>/home/ubuntu/myprojenv/bin/gunicorn --workers <span class="m">3</span> --bind unix:/home/ubuntu/myproject/myproject.sock myproject.wsgi
</pre></div><p>This line is used to define a command which is used when we start or restart our project. </p><div class="highlight"><pre><span></span><span class="nv">directory</span><span class="o">=</span>/home/ubuntu/myproject
</pre></div><p>This line indicates a path from which that command will be run.</p><div class="highlight"><pre><span></span><span class="nv">autostart</span><span class="o">=</span><span class="nb">true</span>
<span class="nv">autorestart</span><span class="o">=</span><span class="nb">true</span>
</pre></div><p>These lines define certain behavior of the script under different conditions. <code>Autostart</code> tells the script to start on system boot and <code>autorestart</code> tells it to restart when it exists for some reason.</p><div class="highlight"><pre><span></span><span class="nv">stderr_logfile</span><span class="o">=</span>/var/log/myproject.err.log
<span class="nv">stdout_logfile</span><span class="o">=</span>/var/log/myproject.out.log
</pre></div><p>And these final lines define two files where different kinds of logs are stored. Obviously, error logs will be stored in <code>myproject.err.log</code> and others in <code>myproject.out.log</code>.</p><p>Let's save the file and execute the following commands to bring these changes into effect:</p><div class="highlight"><pre><span></span>sudo supervisorctl reread
sudo supervisorctl update
</pre></div><p>Well, that's pretty much it. Simple, right? To verify that everything is working, type this:</p><div class="highlight"><pre><span></span>ps ax <span class="p">|</span> grep gunicorn
</pre></div><p>You should see several gunicorn processes running. Or, you can go to <code>localhost:8000</code> and you will see your django app up and running.</p><p>Or, you can now use <code>supervisor</code> to check whether your app is running:</p><div class="highlight"><pre><span></span>sudo supervisorctl status myproject
</pre></div><p>Now, go ahead and play with those <code>supervisorctl</code> commands to start, stop, restart and check the status of your app.</p><p>Let's do one more thing. Let's see the builtin supervisor web interface in action. Those who don't like command line to control processes will love this.</p><p>Open up <code>/etc/supervisor/supervisor.conf</code> and place these lines at the beginning of the file:</p><div class="highlight"><pre><span></span><span class="o">[</span>inet_http_server<span class="o">]</span>
<span class="nv">port</span><span class="o">=</span>0.0.0.0:9001
</pre></div><p>This will indicate that the supervisor web interface will run on <code>0.0.0.0:9001</code>.</p><p>Save the file and reload supervisor:</p><div class="highlight"><pre><span></span>sudo supervisorctl reload
</pre></div><p>Open up your browser and go to <code>0.0.0.0:9001</code>. You will see something like this:</p><div class="gallery large"><a href="/static/images/supervisor.jpg" rel="lightbox" title="Supervisor web interface"><img src="/static/images/supervisor.jpg" alt="Supervisor web interface"><span>Web interface of Supervisor</span></a></div><p>Cool, right?! Go ahead and play with it to control your project.</p><p>Thanks for reading thus far. Now you have one more tool in your arsenal.</p><p><a href="http://rahmonov.me/posts/run-a-django-app-with-gunicorn-in-ubuntu-16-04/">Part I</a></p><p><a href="http://rahmonov.me/posts/run-a-django-app-with-nginx-and-gunicorn/">Part II</a></p></div><div class="pagination clearfix"><a class="prev" href="/posts/run-a-django-app-with-nginx-and-gunicorn/">« Previous</a><a class="next" href="/posts/deploy-a-django-app-to-digitalocean/">Next »</a></ul></div><p><div class="likely likely-big"><div class="facebook">Share</div><div class="twitter" data-via="rahmon0v">Tweet</div><div class="telegram">Send</div><div class="linkedin">Share</div></div></p><div class="end"><span> If you liked what you read, subscribe below. Once in a while, I will send you a list of my new posts. </span><div id="popup"><p><link href="//cdn-images.mailchimp.com/embedcode/classic-10_7.css" rel="stylesheet" type="text/css"><style type="text/css">
                #mc_embed_signup{background:#fff; clear:left; font:14px Helvetica,Arial,sans-serif; }
                /* Add your own MailChimp form style overrides in your site stylesheet or in this style block.
                   We recommend moving this block and the preceding CSS link to the HEAD of your HTML file. */
            </style><div id="mc_embed_signup"><form action="//rahmonov.us16.list-manage.com/subscribe/post?u=9e30bdfdfe0a7bd7cf7e0d50a&id=af3f3c5f76" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate><div id="mc_embed_signup_scroll"><div class="indicates-required"><span class="asterisk">*</span> indicates required</div><div class="mc-field-group"><label for="mce-MMERGE1">Name </label><input type="text" value name="MMERGE1" class id="mce-MMERGE1"></div><div class="mc-field-group"><label for="mce-EMAIL">Email Address <span class="asterisk">*</span></label><input type="email" value name="EMAIL" class="required email" id="mce-EMAIL"></div><div id="mce-responses" class="clear"><div class="response" id="mce-error-response" style="display:none"></div><div class="response" id="mce-success-response" style="display:none"></div></div> <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_9e30bdfdfe0a7bd7cf7e0d50a_af3f3c5f76" tabindex="-1" value></div><div class="clear"><input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button"></div></div></form></div></p></div></div> <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-7110437178205620" data-ad-slot="4409204211" data-ad-format="auto"></ins><script>
    (adsbygoogle = window.adsbygoogle || []).push({});
    </script><div id="disqus_thread"></div><script type="text/javascript">
        /* * * CONFIGURATION VARIABLES * * */
        var disqus_shortname = 'jrahmonov';

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript></div></div></div><script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-67392250-1', 'auto');
      ga('send', 'pageview');
    </script><script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script><script src="/static/js/mobile.js"></script><script src="/static/vendor/lightbox2/js/lightbox.min.js"></script></body></html>